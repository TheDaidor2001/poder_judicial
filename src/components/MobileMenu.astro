---
// src/components/MobileMenu.astro
import { SITE_MENU } from "../config/constants";
---

<!-- Botón Hamburguesa -->
<button
    id="mobile-menu-button"
    class="lg:hidden text-white focus:outline-none"
    aria-label="Menú principal"
>
    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
    </svg>
</button>

<!-- Menú Mobile -->
<div
    id="mobile-menu"
    class="lg:hidden fixed inset-0 bg-primary z-50 transition-all duration-300 ease-in-out opacity-0 invisible"
>
    <div class="container mx-auto px-4 py-8 h-full flex flex-col">
        <!-- Botón de cerrar -->
        <div class="flex justify-end">
            <button
                id="close-menu-button"
                class="text-white p-2 focus:outline-none"
                aria-label="Cerrar menú"
            >
                <svg
                    class="w-8 h-8"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <!-- Lista de menú -->
        <ul class="mt-12 space-y-6">
            {
                SITE_MENU.map((item) => (
                    <li class="border-b border-white/20 pb-4">
                        <div class="flex items-center justify-between">
                            {item.submenu ? (
                                <button
                                    class="text-white text-2xl font-medium py-2 hover:text-blue-300 transition-colors flex-grow text-left submenu-main-button"
                                    onclick="toggleSubmenu(this)"
                                >
                                    {item.text}
                                </button>
                            ) : (
                                <a
                                    href={item.link}
                                    class="text-white text-2xl font-medium py-2 hover:text-blue-300 transition-colors"
                                >
                                    {item.text}
                                </a>
                            )}

                            {item.submenu && (
                                <button
                                    class="submenu-toggle text-white p-2 focus:outline-none"
                                    aria-label="Abrir submenú"
                                    onclick="toggleSubmenu(this)"
                                >
                                    <svg
                                        class="w-6 h-6 transform transition-transform duration-300"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M19 9l-7 7-7-7"
                                        />
                                    </svg>
                                </button>
                            )}
                        </div>

                        {item.submenu && (
                            <ul class="ml-4 mt-2 space-y-2 submenu hidden">
                                {item.submenu.map((subitem) => (
                                    <li>
                                        <a
                                            href={subitem.link}
                                            class="block text-white/80 py-1 hover:text-blue-300 transition-colors"
                                        >
                                            {subitem.text}
                                        </a>
                                    </li>
                                ))}
                            </ul>
                        )}
                    </li>
                ))
            }
        </ul>
    </div>
</div>

<script is:inline>
    document.addEventListener("DOMContentLoaded", () => {
        const menuButton = document.getElementById("mobile-menu-button");
        const closeButton = document.getElementById("close-menu-button");
        const mobileMenu = document.getElementById("mobile-menu");

        // Toggle menu principal
        const toggleMenu = () => {
            mobileMenu.classList.toggle("opacity-0");
            mobileMenu.classList.toggle("invisible");
            mobileMenu.classList.toggle("opacity-100");
            mobileMenu.classList.toggle("visible");

            // Bloquear scroll del body cuando el menú está abierto
            document.body.style.overflow = mobileMenu.classList.contains(
                "opacity-100",
            )
                ? "hidden"
                : "";
        };

        menuButton.addEventListener("click", toggleMenu);
        closeButton.addEventListener("click", toggleMenu);

        // Función global para toggle de submenús
        window.toggleSubmenu = (element) => {
            // Obtener el elemento li padre
            const parentLi = element.closest("li");
            // Obtener el submenú dentro de este li
            const submenu = parentLi.querySelector(".submenu");
            // Obtener todos los elementos relacionados
            const arrow = parentLi.querySelector(".submenu-toggle svg");
            const mainButton = parentLi.querySelector(".submenu-main-button");

            // Alternar visibilidad del submenú
            submenu.classList.toggle("hidden");

            // Rotar la flecha
            if (arrow) {
                if (submenu.classList.contains("hidden")) {
                    arrow.classList.remove("rotate-180");
                } else {
                    arrow.classList.add("rotate-180");
                }
            }
        };

        // Cerrar menú principal al hacer clic en enlaces sin submenú
        mobileMenu.querySelectorAll("a").forEach((link) => {
            if (!link.closest(".submenu")) {
                link.addEventListener("click", () => {
                    if (!link.parentElement.querySelector(".submenu-toggle")) {
                        toggleMenu();
                    }
                });
            }
        });
    });
</script>

<style is:global>
    /* Rotación de flecha */
    .rotate-180 {
        transform: rotate(180deg);
    }

    /* Transición para submenús */
    .submenu {
        transition: all 0.3s ease;
    }
</style>
