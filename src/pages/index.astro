---
import MainLayout from "../layouts/MainLayout.astro";
import RightArrow from "../components/icons/rightArrow.astro";
import { fetchNewsPaginated, formatPublishedDate } from "../utils/newsAPI";

// Obtener las 3 últimas noticias
let latestNews: any[] = [];
let error: string | null = null;

try {
  const result = await fetchNewsPaginated(1);
  latestNews = result.news.slice(0, 3); // Tomar solo las 3 primeras
} catch (e) {
  error = e instanceof Error ? e.message : 'Error desconocido al cargar noticias';
  console.error('Error fetching news:', e);
}
---

<MainLayout title="Poder Judicial de Guinea Ecuatorial | Inicio">
	<section class="relative">
		<img
			src="/images/palacio_justicia.jpg"
			alt=""
			class="w-full h-screen object-cover"
		/>
		<div class="absolute inset-0 w-full h-screen bg-black opacity-30"></div>

		<div class="absolute inset-0 flex items-center justify-center">
			<!-- Contenido centrado aquí -->
			<div
				class="text-center text-white p-8 rounded-lg max-w-6xl mx-0 md:mx-4"
			>
				<h1
					class="text-3xl md:text-5xl lg:text-7xl font-bold mb-4 uppercase text-balance"
				>
					Poder Judicial de Guinea Ecuatorial
				</h1>
				<p class="text-lg md:text-xl">
					Facilitamos el acceso a información y recursos legales para
					todos.
				</p>
				<div
					class="mt-10 flex flex-col sm:flex-row justify-center gap-x-5 gap-y-5"
				>
					<a
						href="/contacto"
						class="bg-secondary px-3 py-2 rounded-md text-sm md:text-lg cursor-pointer hover:scale-105 transition-transform"
						>Más Información</a
					>
					<a
						href="/historia"
						class="border border-white px-3 py-2 rounded-md flex items-center-safe justify-center gap-x-2 cursor-pointer group hover:bg-white hover:scale-105 transition"
					>
						<span class="group-hover:text-black"
							>Historia del palacio</span
						>
						<RightArrow
							classname="size-5 text-white mt-1 group-hover:text-black"
						/>
					</a>
				</div>
			</div>
		</div>
	</section>
	<section class="bg-primary">
		<div class="flex flex-col justify-center p-10 text-center max-w-5xl mx-auto px-5 md:px-0">
			<h5 class="text-secondary text-lg md:text-xl mb-3">
				Su Socio en el Ámbito Legal
			</h5>
			<h3 class="text-white text-3xl md:text-5xl mb-7">
				Acceda a la Justicia de Forma Sencilla
			</h3>
			<p class="text-white text-sm md:text-lg">
				En el Palacio de Justicia, le brindamos el apoyo necesario para
				resolver sus dudas legales. Nuestro equipo está aquí para
				asistirle en cada paso del camino.
			</p>

			<a
				href="/contacto"
				class="text-secondary border border-secondary px-5 py-2 w-fit mt-10 rounded-md text-lg hover:bg-secondary hover:text-white transition-colors mx-auto"
				>Contáctanos</a
			>
		</div>
	</section>
	<section class="max-w-6xl mx-auto my-32 px-5 lg:px-0">
		<!-- Header -->
		<div class="mb-16">
			<h2 class="text-3xl md:text-4xl font-light text-gray-800 mb-2 tracking-wide">
				Noticias Recientes
			</h2>
			<div class="w-16 h-px bg-primary"></div>
		</div>

		{error && (
			<div class="border border-red-200 bg-red-50 p-6">
				<p class="text-red-700 text-sm">Error al cargar noticias: {error}</p>
			</div>
		)}

		{!error && latestNews.length === 0 && (
			<div class="border border-yellow-200 bg-yellow-50 p-6">
				<p class="text-yellow-700 text-sm">No hay noticias disponibles en este momento.</p>
			</div>
		)}

		{!error && latestNews.length > 0 && (
			<div class="space-y-12">
				{latestNews.map((noticia, index) => (
					<article class="group border-b border-gray-200 pb-12 last:border-b-0 last:pb-0">
						<a href={`/noticias/${noticia.slug}`} class="grid grid-cols-1 md:grid-cols-12 gap-8 items-start">
							<!-- Imagen -->
							{noticia.imageUrl && (
								<div class="md:col-span-5 overflow-hidden">
									<img
										src={noticia.imageUrl}
										alt={noticia.title}
										class="w-full aspect-[4/3] object-cover group-hover:scale-105 transition-all duration-500"
									/>
								</div>
							)}

							<!-- Contenido -->
							<div class={`${noticia.imageUrl ? 'md:col-span-7' : 'md:col-span-12'} flex flex-col justify-between h-full`}>
								<!-- Fecha y número -->
								<div class="flex items-baseline gap-4 mb-4">
									<span class="text-5xl font-light text-gray-300">{String(index + 1).padStart(2, '0')}</span>
									<time class="text-sm text-gray-500 uppercase tracking-wider">
										{formatPublishedDate(noticia.publishedAt)}
									</time>
								</div>

								<!-- Título -->
								<h3 class={`${index === 0 ? 'text-3xl md:text-4xl' : 'text-2xl md:text-3xl'} font-light text-gray-900 mb-4 leading-tight group-hover:text-primary transition-colors duration-200`}>
									{noticia.title}
								</h3>

								<!-- Descripción -->
								{noticia.subtitle && (
									<p class="text-gray-600 leading-relaxed mb-6 line-clamp-3">
										{noticia.subtitle}
									</p>
								)}

								<!-- Link -->
								<div class="flex items-center text-primary text-sm uppercase tracking-wider font-medium group-hover:gap-3 gap-2 transition-all">
									<span>Leer artículo completo</span>
									<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
									</svg>
								</div>
							</div>
						</a>
					</article>
				))}
			</div>
		)}

		<!-- Enlace a ver todas las noticias -->
		{!error && latestNews.length > 0 && (
			<div class="mt-16 pt-12 border-t border-gray-200">
				<a
					href="/noticias_judiciales"
					class="inline-flex items-center gap-3 text-primary text-sm uppercase tracking-wider font-medium hover:gap-5 transition-all duration-300"
				>
					<span>Ver todas las noticias</span>
					<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
					</svg>
				</a>
			</div>
		)}
	</section>
</MainLayout>
